

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Payload Interfaces &mdash; Universal Scalable Firmware (USF)  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Appendix A – HOB Data Structures" href="appendix-a.html" />
    <link rel="prev" title="Hand-off state" href="hand-off-state.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Universal Scalable Firmware (USF)
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usf/index.html">Universal Scalable Firmware (USF) Specification</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Universal Payload</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="revision-history.html">Universal Payload Revision History</a></li>
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="image-format.html">Payload Image Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="hand-off-state.html">Hand-off state</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Payload Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#acpi-tables">ACPI tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hob-list">HOB List</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#reusing-interfaces-in-platform-initialization-specification">Reusing Interfaces in Platform Initialization Specification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#new-interfaces">New Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-interfaces">Optional Interfaces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="appendix-a.html">Appendix A – HOB Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html">References and Links</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Universal Scalable Firmware (USF)</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Universal Payload</a> &raquo;</li>
        
      <li>Payload Interfaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="payload-interfaces">
<h1>Payload Interfaces<a class="headerlink" href="#payload-interfaces" title="Permalink to this headline">¶</a></h1>
<p>The bootloader provides platform information to payload through
standard ACPI table, SMBIOS table, Device tree and a series of data
structures called the Hand Off Blocks (HOBs). If the information is
already defined in ACPI specification, SMBIOS specification or device
tree, the payload could parse them to get the required information.
For the platform information that is not defined in the standard
tables, the bootloader should build a HOB list to pass it to the
payload.</p>
<p>Open: Do we need a set of configuration data to config payload?</p>
<blockquote>
<div>We do not believe so.</div></blockquote>
<p>Open: Do we need pass data from payload to bootloader to impact bootloader behavior in next boot?</p>
<blockquote>
<div>Keep it open now.</div></blockquote>
<p>Open: will payload be run in S3 path?</p>
<blockquote>
<div>Suggest skipping payload.</div></blockquote>
<div class="section" id="acpi-tables">
<span id="id1"></span><h2>ACPI tables<a class="headerlink" href="#acpi-tables" title="Permalink to this headline">¶</a></h2>
<p>ACPI table is required to boot modern operation system, especially to boot windows operating system.
The bootloader should provide a ACPI RSDP HOB. In the ACPI table least RSDT, FADT and MCFG should be available to the payload.
Payload could remove/add/modify the ACPI table passed from the bootloader if required.</p>
<p>The payload could parse the ACPI table to get some basic platform
information. For example, the Fixed ACPI Description Table (FADT)
defines various fixed hardware ACPI information to an ACPI compatible
OS, such as the base address for the following hardware registers
blocks: PM1a_CNT_BLK, PM_TMR_BLK, PM1a_EVT_BLK, GPE0_BLK,
PM1b_EVT_BLK, PM1b_CNT_BLK, PM2_CNT_BLK, and GPE1_BLK. The payload
could use them and other values (e.g. RESET_REG, RESET_VALUE) to make
the payload platform independent.</p>
<p>The other example is to get PCIE base address from ACPI memory mapped
configuration space access table definition, defined in the PCI
Firmware Specification.
<cite>http://www.pcisig.com &lt;http://www.pcisig.com/&gt;</cite>.</p>
<p>And another example is on the debug device info. The bootloader might
report debug device following up ACPI Debug Port Table 2 (DBG2). If a
fully 16550-compatible serial device is specified in the ACPI DBG2,
bootloader should provide a Serial Debug Information HOB in the HOB
list so that the payload could use same debug device with same
setting. If the ACPI DBG2 table could not be found, the payload
should use serial device provided by the Serial Debug Information HOB
as the default debug device.</p>
</div>
<div class="section" id="hob-list">
<h2>HOB List<a class="headerlink" href="#hob-list" title="Permalink to this headline">¶</a></h2>
<p>The bootloader should build a HOB list and pass the HOB list header
to payload when passing control to payload. The HOB format is
described in the <em>Platform Initialization (PI) Specification - Volume
3: Shared Architectural Elements</em>.</p>
<p>There are two sections below describing the HOBs produced by the
bootloader and consumed by the payload for providing the system
architecturally information.</p>
<p>First section describes the HOBs defined in <em>Platform Initialization
Specification Volume 3: Shared Architectural elements</em>.</p>
<p>Second section defines the new HOBs.</p>
<div class="section" id="reusing-interfaces-in-platform-initialization-specification">
<h3>Reusing Interfaces in Platform Initialization Specification<a class="headerlink" href="#reusing-interfaces-in-platform-initialization-specification" title="Permalink to this headline">¶</a></h3>
<div class="section" id="phit-phase-handoff-info-table-hob">
<h4>PHIT(Phase Handoff Info Table) HOB<a class="headerlink" href="#phit-phase-handoff-info-table-hob" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should report the general state information through
the HOB following EFI_HOB_HANDOFF_INFO_TABLE format defined in
<em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
</div>
<div class="section" id="cpu-hob">
<h4>CPU HOB<a class="headerlink" href="#cpu-hob" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should report the processor information including address space
and I/O space capabilities to the payload through the HOB following
EFI_HOB_CPU format defined in <em>Platform Initialization Specification Volume 3:
Shared Architectural elements</em>.</p>
</div>
<div class="section" id="resource-descriptor-hob">
<h4>Resource Descriptor HOB<a class="headerlink" href="#resource-descriptor-hob" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should report the system resources through the HOB
following EFI_HOB_RESOURCE_DESCRIPTOR format defined in <em>Platform
Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
<p>For example, any physical memory found in bootloader should be
reported using resource type EFI_RESOURCE_SYSTEM_MEMORY, and the
reserved memory used by bootloader should be reported using resource
type EFI_RESOURCE_MEMORY_RESERVED.</p>
<p>I/O and memory mapped I/O resource should also be reported using
resource type EFI_RESOURCE_IO and EFI_RESOURCE_MEMORY_MAPPED_IO.</p>
</div>
<div class="section" id="memory-allocation-hob">
<h4>Memory Allocation HOB<a class="headerlink" href="#memory-allocation-hob" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should report the memory usages that exist outside the
HOB list through the HOB following EFI_HOB_MEMORY_ALLOCATION format defined
in <em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
<div class="section" id="boot-strap-processor-bsp-stack-memory-allocation-hob">
<h5>Boot-Strap Processor (BSP) Stack Memory Allocation HOB<a class="headerlink" href="#boot-strap-processor-bsp-stack-memory-allocation-hob" title="Permalink to this headline">¶</a></h5>
<p>The bootloader should report the initial stack prepared for payload through
the HOB following EFI_HOB_MEMORY_ALLOCATION_STACK format defined in <em>Platform
Initialization Specification Volume 3: Shared Architectural elements</em>.</p>
</div>
<div class="section" id="memory-allocation-module-hob">
<h5>Memory Allocation Module HOB<a class="headerlink" href="#memory-allocation-module-hob" title="Permalink to this headline">¶</a></h5>
<p>The bootloader should report the payload memory location and entry point
through the HOB following EFI_HOB_MEMORY_ALLOCATION_MODULE format defined
in <em>Platform Initialization Specification Volume 3: Shared Architectural
elements</em>.</p>
</div>
</div>
<div class="section" id="graphics-information-hob">
<h4>Graphics information HOB<a class="headerlink" href="#graphics-information-hob" title="Permalink to this headline">¶</a></h4>
<p>If bootloader initializes the graphics device, the bootloader might
report graphics mode and framebuffer information through
EFI_PEI_GRAPHICS_INFO_HOB, and graphics hardware information
through EFI_PEI_GRAPHICS_DEVICE_INFO_HOB.</p>
<p>EFI_PEI_GRAPHICS_INFO_HOB and EFI_PEI_GRAPHICS_DEVICE_INFO_HOB provide the basic information
for the graphics display. These HOBs are described in the <em>PI Specification.</em></p>
<p>Please refer Appendix 6.6 EFI_PEI_GRAPHICS_INFO_HOB and 6.7 EFI_PEI_GRAPHICS_DEVICE_INFO_HOB for the details.</p>
</div>
</div>
<div class="section" id="new-interfaces">
<h3>New Interfaces<a class="headerlink" href="#new-interfaces" title="Permalink to this headline">¶</a></h3>
<div class="section" id="common-payload-header">
<h4>Common Payload Header<a class="headerlink" href="#common-payload-header" title="Permalink to this headline">¶</a></h4>
<p>All new interfaces are GUID type HOBs starting with <code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code> defined in the PI Specification.</p>
<p>The HOB data starts with a common header defined as below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT8</span>                <span class="n">Revision</span><span class="p">;</span>
  <span class="n">UINT8</span>                <span class="n">Reserved</span><span class="p">;</span>
  <span class="n">UINT16</span>               <span class="n">Length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Revision</span></code></p>
<p>It doesn’t increase when new members are appended to the end of the interface.</p>
<p>It increases by one when existing members are renamed or re-interpreted for different purposes.</p>
<p><code class="docutils literal notranslate"><span class="pre">Length</span></code></p>
<p>The Length equals to the sizeof (UNIVERSAL_PAYLOAD_GENERIC_HEADER) + sizeof (&lt;additional members&gt;).</p>
<p>Consumers of the interfaces should only access those members that are covered by Length.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code> contains a Length field to tell the actual bytes the whole HOB data occupies.</p>
<p>It also includes the optional padding bytes to make sure each HOB is multiple of 8 bytes in length.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">UNIVERSAL_PAYLOAD_GENERIC_HEADER.Length</span></code> tells the exact length of the meaningful data excluding the padding bytes.
So, it’s always true that <code class="docutils literal notranslate"><span class="pre">UNIVERSAL_PAYLOAD_GENERIC_HEADER.Length</span></code> is less than or equal to the Length in <code class="docutils literal notranslate"><span class="pre">EFI_HOB_GUID_TYPE</span></code>.</p>
</div>
<p>HOB data for different interfaces is defined in following sections.</p>
</div>
<div class="section" id="acpi-table">
<h4>ACPI Table<a class="headerlink" href="#acpi-table" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should pass ACPI table the payload. So that the payload could get the platform information from the ACPI table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadAcpiTableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x9f9a9506</span><span class="p">,</span> <span class="mh">0x5597</span><span class="p">,</span> <span class="mh">0x4515</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x87</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">Rsdp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_ACPI_TABLE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">Rsdp</span></code></p>
<p>Point to the ACPI RSDP table. The ACPI table need follow ACPI specification version 2.0 or above.</p>
</div>
<div class="section" id="smbios-table">
<h4>SMBIOS Table<a class="headerlink" href="#smbios-table" title="Permalink to this headline">¶</a></h4>
<p>The bootloader might pass SMBIOS table to the payload. So that the payload could get the platform information from the table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadSmbios3TableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x92b7896c</span><span class="p">,</span> <span class="mh">0x3362</span><span class="p">,</span> <span class="mh">0x46ce</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x42</span> <span class="p">}</span> <span class="p">}</span>

<span class="n">gUniversalPayloadSmbiosTableGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x590a0d26</span><span class="p">,</span> <span class="mh">0x06e5</span><span class="p">,</span> <span class="mh">0x4d20</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x2d</span> <span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">SmBiosEntryPoint</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_SMBIOS_TABLE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">SmBiosEntryPoint</span></code></p>
<p>Points to the SMBIOS table in SMBIOS 3.0+ format if GUID is <code class="docutils literal notranslate"><span class="pre">gUniversalPayloadSmbios3TableGuid</span></code>.</p>
<p>Points to the SMBIOS table in SMBIOS 2.x format if GUID is <code class="docutils literal notranslate"><span class="pre">gUniversalPayloadSmbiosTableGuid</span></code>.</p>
</div>
<div class="section" id="device-tree">
<h4>DEVICE TREE<a class="headerlink" href="#device-tree" title="Permalink to this headline">¶</a></h4>
<p>The bootloader might pass Device Tree to the payload. So that the payload could get the platform information from the table.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadDeviceTreeGuid</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x6784b889</span><span class="p">,</span> <span class="mh">0xb13c</span><span class="p">,</span> <span class="mh">0x4c3b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack (1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">DeviceTreeAddress</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_DEVICE_TREE</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 12.</p>
<p><code class="docutils literal notranslate"><span class="pre">DeviceTreeAddress</span></code></p>
<p>Point to the Device Tree entry point.</p>
</div>
<div class="section" id="serial-information">
<h4>Serial Information<a class="headerlink" href="#serial-information" title="Permalink to this headline">¶</a></h4>
<p>If the debug device type and subtype are specified in DBG2, the
bootloader should 16550 compatible serial debug port information
to payload.</p>
<p><strong>Opens: Should we let bootloader provide debug callback</strong> <strong>for debug?</strong></p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadSerialPortInfoGuid</span>   <span class="o">=</span> <span class="p">{</span><span class="mh">0xaa7e190d</span><span class="p">,</span> <span class="mh">0xbe21</span><span class="p">,</span> <span class="mh">0x4409</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                          <span class="n">UseMmio</span><span class="p">;</span>
  <span class="n">UINT8</span>                            <span class="n">RegisterStride</span><span class="p">;</span>
  <span class="n">UINT32</span>                           <span class="n">BaudRate</span><span class="p">;</span>
  <span class="n">EFI_PHYSICAL_ADDRESS</span>             <span class="n">RegisterBase</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_SERIAL_PORT_INFO</span><span class="p">;</span>

<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 18.</p>
<p><code class="docutils literal notranslate"><span class="pre">UseMmio</span></code></p>
<p>Indicates the 16550 serial port registers are in MMIO space, or in I/O space.</p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterStride</span></code></p>
<p>Indicates the number of bytes between registers.</p>
<p><code class="docutils literal notranslate"><span class="pre">BaudRate</span></code></p>
<p>Baud rate for the 16550 compatible serial port.</p>
<p>It could be 921600, 460800, 230400, 115200, 57600, 38400, 19200,
9600, 7200, 4800, 3600, 2400, 2000, 1800, 1200, 600, 300, 150, 134,
110, 75, 50</p>
<p>Set to 0 to use the default baud rate 115200.</p>
<p><code class="docutils literal notranslate"><span class="pre">RegisterBase</span></code></p>
<p>Base address of 16550 serial port registers in MMIO or I/O space.</p>
</div>
<div class="section" id="pci-root-bridges">
<h4>PCI Root Bridges<a class="headerlink" href="#pci-root-bridges" title="Permalink to this headline">¶</a></h4>
<p>The bootloader should pass information about PCI root bridges to the payload. The information tells the payload whether the PCI bus
enumeration has been performed by the bootloader, the bus, IO and MMIO ranges that are used or will be used by the PCI bus.</p>
<p><strong>GUID</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gUniversalPayloadPciRootBridgeInfoGuid</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xec4ebacb</span><span class="p">,</span> <span class="mh">0x2638</span><span class="p">,</span> <span class="mh">0x416e</span><span class="p">,</span> <span class="p">{</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">}}</span>
</pre></div>
</div>
<p><strong>Structure</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#pragma pack(1)</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UNIVERSAL_PAYLOAD_GENERIC_HEADER</span>  <span class="n">Header</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                           <span class="n">ResourceAssigned</span><span class="p">;</span>
  <span class="n">UINT8</span>                             <span class="n">Count</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE</span> <span class="n">RootBridge</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGES</span><span class="p">;</span>

<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">UINT32</span>                                     <span class="n">Segment</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">Supports</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">Attributes</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                                    <span class="n">DmaAbove4G</span><span class="p">;</span>
  <span class="n">BOOLEAN</span>                                    <span class="n">NoExtendedConfigSpace</span><span class="p">;</span>
  <span class="n">UINT64</span>                                     <span class="n">AllocationAttributes</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Bus</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Io</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">Mem</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">MemAbove4G</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">PMem</span><span class="p">;</span>
  <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span> <span class="n">PMemAbove4G</span><span class="p">;</span>
  <span class="n">UINT32</span>                                     <span class="n">HID</span><span class="p">;</span>
  <span class="n">UINT32</span>                                     <span class="n">UID</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE</span><span class="p">;</span>

<span class="o">//</span>
<span class="o">//</span> <span class="p">(</span><span class="n">Base</span> <span class="o">&gt;</span> <span class="n">Limit</span><span class="p">)</span> <span class="n">indicates</span> <span class="n">an</span> <span class="n">aperture</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">available</span><span class="o">.</span>
<span class="o">//</span>
<span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">Base</span> <span class="ow">and</span> <span class="n">Limit</span> <span class="n">are</span> <span class="n">the</span> <span class="n">device</span> <span class="n">address</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">host</span> <span class="n">address</span> <span class="n">when</span>
  <span class="o">//</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">zero</span>
  <span class="o">//</span>
  <span class="n">UINT64</span> <span class="n">Base</span><span class="p">;</span>
  <span class="n">UINT64</span> <span class="n">Limit</span><span class="p">;</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">According</span> <span class="n">to</span> <span class="n">UEFI</span> <span class="mf">2.7</span><span class="p">,</span> <span class="n">Device</span> <span class="n">Address</span> <span class="o">=</span> <span class="n">Host</span> <span class="n">Address</span> <span class="o">+</span> <span class="n">Translation</span><span class="p">,</span>
  <span class="o">//</span> <span class="n">so</span> <span class="n">Translation</span> <span class="o">=</span> <span class="n">Device</span> <span class="n">Address</span> <span class="o">-</span> <span class="n">Host</span> <span class="n">Address</span><span class="o">.</span>
  <span class="o">//</span> <span class="n">On</span> <span class="n">platforms</span> <span class="n">where</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">zero</span><span class="p">,</span> <span class="n">the</span> <span class="n">subtraction</span> <span class="ow">is</span> <span class="n">probably</span> <span class="n">to</span>
  <span class="o">//</span> <span class="n">be</span> <span class="n">performed</span> <span class="k">with</span> <span class="n">UINT64</span> <span class="n">wrap</span><span class="o">-</span><span class="n">around</span> <span class="n">semantics</span><span class="p">,</span> <span class="k">for</span> <span class="n">we</span> <span class="n">may</span> <span class="n">translate</span> <span class="n">an</span>
  <span class="o">//</span> <span class="n">above</span><span class="o">-</span><span class="mi">4</span><span class="n">G</span> <span class="n">host</span> <span class="n">address</span> <span class="n">into</span> <span class="n">a</span> <span class="n">below</span><span class="o">-</span><span class="mi">4</span><span class="n">G</span> <span class="n">device</span> <span class="n">address</span> <span class="k">for</span> <span class="n">legacy</span> <span class="n">PCIe</span> <span class="n">device</span>
  <span class="o">//</span> <span class="n">compatibility</span><span class="o">.</span>
  <span class="o">//</span>
  <span class="o">//</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">The</span> <span class="n">alignment</span> <span class="n">of</span> <span class="n">Translation</span> <span class="ow">is</span> <span class="n">required</span> <span class="n">to</span> <span class="n">be</span> <span class="n">larger</span> <span class="n">than</span> <span class="nb">any</span> <span class="n">BAR</span>
  <span class="o">//</span> <span class="n">alignment</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">same</span> <span class="n">root</span> <span class="n">bridge</span><span class="p">,</span> <span class="n">so</span> <span class="n">that</span> <span class="n">the</span> <span class="n">same</span> <span class="n">alignment</span> <span class="n">can</span> <span class="n">be</span>
  <span class="o">//</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">both</span> <span class="n">device</span> <span class="n">address</span> <span class="ow">and</span> <span class="n">host</span> <span class="n">address</span><span class="p">,</span> <span class="n">which</span> <span class="n">simplifies</span> <span class="n">the</span>
  <span class="o">//</span> <span class="n">situation</span> <span class="ow">and</span> <span class="n">makes</span> <span class="n">the</span> <span class="n">current</span> <span class="n">resource</span> <span class="n">allocation</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">generic</span> <span class="n">PCI</span>
  <span class="o">//</span> <span class="n">host</span> <span class="n">bridge</span> <span class="n">driver</span> <span class="n">still</span> <span class="n">work</span><span class="o">.</span>
  <span class="o">//</span>
  <span class="n">UINT64</span> <span class="n">Translation</span><span class="p">;</span>
<span class="p">}</span> <span class="n">UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE_APERTURE</span><span class="p">;</span>
<span class="c1">#pragma pack()</span>
</pre></div>
</div>
<p><strong>Member Description</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">Header</span></code></p>
<p>Header.Revision is 1.</p>
<p>Header.Length is 6 + <code class="docutils literal notranslate"><span class="pre">Count</span></code> * sizeof (UNIVERSAL_PAYLOAD_PCI_ROOT_BRIDGE).</p>
<p><code class="docutils literal notranslate"><span class="pre">ResourceAssigned</span></code></p>
<p>Bus/IO/MMIO resources for all root bridges have been assigned when it’s TRUE.</p>
<p><code class="docutils literal notranslate"><span class="pre">Count</span></code></p>
<p>Count of root bridges. Number of elements in <code class="docutils literal notranslate"><span class="pre">RootBridge</span></code> array.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Segment</span></code></p>
<p>Segment number of the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Supports</span></code></p>
<p>Supported attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL
defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Attributes</span></code></p>
<p>Initial attributes. Refer to EFI_PCI_ATTRIBUTE_xxx used by GetAttributes() and SetAttributes() in EFI_PCI_ROOT_BRIDGE_IO_PROTOCOL
defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].DmaAbove4G</span></code></p>
<p>Root bridge supports DMA above 4GB memory when it’s TRUE.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].NoExtendedConfigSpace</span></code></p>
<p>Root bridge supports 256-byte configuration space only when it’s TRUE.
Root bridge supports 4K-byte configuration space when it’s FALSE.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].AllocationAttributes</span></code></p>
<p>Allocation attributes. Refer to EFI_PCI_HOST_BRIDGE_COMBINE_MEM_PMEM and EFI_PCI_HOST_BRIDGE_MEM64_DECODE used by GetAllocAttributes()
in EFI_PCI_HOST_BRIDGE_RESOURCE_ALLOCATION_PROTOCOL defined in PI Specification.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Bus</span></code></p>
<p>Bus aperture for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Io</span></code></p>
<p>IO aperture for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].Mem</span></code></p>
<p>MMIO aperture below 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].MemAbove4G</span></code></p>
<p>MMIO aperture above 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].PMem</span></code></p>
<p>Prefetchable MMIO aperture below 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].PMemAbove4G</span></code></p>
<p>Prefetchable MMIO aperture above 4GB for the root bridge.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].HID</span></code></p>
<p>PnP hardware ID of the root bridge. This value must match the corresponding _HID in the ACPI name space.</p>
<p><code class="docutils literal notranslate"><span class="pre">RootBridge[i].UID</span></code></p>
<p>Unique ID that is required by ACPI if two devices have the same _HID. This value must also match the corresponding _UID/_HID pair in the ACPI name space.</p>
</div>
</div>
<div class="section" id="optional-interfaces">
<h3>Optional Interfaces<a class="headerlink" href="#optional-interfaces" title="Permalink to this headline">¶</a></h3>
<p>Some more HOBs could be built by bootloaders for advanced features. e.g.:</p>
<blockquote>
<div><p>Support FVs (also other format) from bootloader to payload</p>
<p>Add debug log as HOB to payload</p>
</div></blockquote>
<p><strong>Opens</strong>: Does the bootloader need report IO info to payload?</p>
<blockquote>
<div>Better let the bootloader to report it,</div></blockquote>
<p><strong>Opens</strong>: does the HOB List need a checksum?</p>
<blockquote>
<div>It looks not too much value. Keep it open if we really need it.</div></blockquote>
<p><strong>Opens</strong>: For some information it is already in ACPI table, should bootloader build HOB for same info?</p>
<blockquote>
<div>Payload could have a check to ACPI table to get basic info they need.</div></blockquote>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="appendix-a.html" class="btn btn-neutral float-right" title="Appendix A – HOB Data Structures" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="hand-off-state.html" class="btn btn-neutral" title="Hand-off state" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Content on this site is licensed under a Creative Commons Attribution 4.0 International license
      Last updated on Oct 20, 2021.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>